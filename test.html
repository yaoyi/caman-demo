<html>
	<head>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js">
		</script>
		<script type="text/javascript" src="js/caman.full.js"></script>
		<script type="text/javascript">
			Caman.Filter.register("tint", function(adjust){
				var rgb, cmyk;
				if (arguments.length === 3){
					rgb = {
						r: 255 * (100 - arguments[0])/100,
						g: 255 * (100 - arguments[1])/100,
						b: 255 * (100 - arguments[2])/100
					}
				}
				console.log(rgb)
				this.greyscale()
				this.newLayer(function() {
				      this.setBlendingMode("multiply");
				      return this.fillColor(rgb.r, rgb.g, rgb.b);
				});
				return this
			})
			$(function(){
				$('#btn-apply').click(function(){
					var c = $('input[name="c"]').val()
					var y = $('input[name="y"]').val()
					var m = $('input[name="m"]').val()
					Caman("#image", function(){
					 	console.log('loading')
						// this.tint(c,y,m)
						// this.greenish()
						this.retro()
					 	this.render();
					})
				})		
			})

			Caman.Filter.register("reddish", function(adjust){
				this.vignette("60%",30)
				this.newLayer(function() {
				    this.setBlendingMode("screen");
				    this.opacity(15)
				    return this.fillColor(255, 0, 0);
				});
				var c = {r:[],g:[],b:[]};
				var rgb = function(x){
					return -12 * Math.sin( x * 2 * Math.PI / 255 ) + x;
				}
				for(var i=0;i<=255;++i) {
        			c.r[i] = rgb(i);
        			c.g[i] = rgb(i);
        			c.b[i] = rgb(i);
     			}
				return this.process("reddish", function(rgba){
					rgba.r = c.r[rgba.r]
					rgba.g = c.g[rgba.g]
					rgba.b = c.b[rgba.b]

					return rgba
				})
			});

			Caman.Filter.register("greenish", function(adjust){
				this.vignette("60%",30)
				this.newLayer(function() {
				    this.setBlendingMode("screen");
				    this.opacity(15)
				    return this.fillColor(255, 255, 0);
				});
				// this.newLayer(function() {
    //   				this.setBlendingMode("softLight");
    //   				this.opacity(80);
    //   				return this.fillColor("#f49600");
    // 			});
				var c = {r:[],g:[],b:[]};
				var rgb = function(x){
					return -12 * Math.sin( x * 2 * Math.PI / 255 ) + x;
				}
				for(var i=0;i<=255;++i) {
        			c.r[i] = rgb(i);
        			c.g[i] = rgb(i);
        			c.b[i] = rgb(i);
     			}
				return this.process("greenish", function(rgba){
					rgba.r = c.r[rgba.r]
					rgba.g = c.g[rgba.g]
					rgba.b = c.b[rgba.b]

					return rgba
				})
			});

			Caman.Filter.register("retro", function(adjust){
				var rgb = function(x){
					return -12 * Math.sin( x * 2 * Math.PI / 255 ) + x;
				}

				var rgb_r = function(x){
					return -.2 * Math.pow(255 * x, .5) * Math.sin(Math.PI * (-195e-7 * Math.pow(x, 2) + .0125 * x)) + x
				}

				var rgb_g = function(x){
					return -.001045244139166791 * Math.pow(x, 2) + 1.2665372554875318 * x
				}

				var rgb_b = function(x){
					return .57254902 * x + 53
				}
				var c = {r:[],g:[],b:[]};
				for(var i=0;i<=255;++i) {
        			c.r[i] = rgb_r(rgb(i));
        			c.g[i] = rgb_g(rgb(i));
        			c.b[i] = rgb_b(rgb(i));
     			}
				return this.process('retro', function(rgba){
					rgba.r = c.r[rgba.r]
					rgba.g = c.g[rgba.g]
					rgba.b = c.b[rgba.b]
					return rgba
				})
			})

			// Caman("#image", function(){
			//  	console.log('loading')
			// 	this.tint(0,0,33)
			//  	this.render();
			// })
		</script>
	</head>
	<body>
		<div>
			<div>
				<span>c: </span><input type="text" name="c" placeholder="0 - 100">
				<span>y: </span><input type="text" name="y" placeholder="0 - 100">
				<span>m: </span><input type="text" name="m" placeholder="0 - 100">
				<button id="btn-apply">Apply</button>
			</div>
			<div>
				<div style="display:inline-block; margin-right: 20px;">
					<h2>before</h2>
					<img src="images/test.jpg" alt="">
				</div>
				<div style="display:inline-block">
					<h2>after</h2>
					<img id="image" src="images/test.jpg" alt="">
				</div>
			</div>
			
		</div>
	</body>
</html>